$fonts: (
  (family: "sans", style: normal, weight: 400, file: "sans_regular"),
  (family: "sans", style: normal, weight: 700, file: "sans_bold"),
  (family: "sans", style: italic, weight: 400, file: "sans_italic"),
  (family: "sans", style: italic, weight: 700, file: "sans_bold_italic"),
  (family: "mono", style: normal, weight: 400, file: "mono_regular"),
  (family: "mono", style: italic, weight: 400, file: "mono_italic")
);

$font-stacks: (
  sans: ("sans", -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif),
  mono: ("mono", "SFMono-Regular", Menlo, Consolas, "Liberation Mono", monospace)
);

@use "sass:map";
@use "sass:string";
@use "env" as *;

@function _with-slash($path) {
  @return if(string.slice($path, -1) == "/", $path, "#{$path}/");
}

@mixin font-face($f, $base) {
  @font-face {
    font-family: "#{map.get($f, family)}";
    src: url("#{$base}#{map.get($f, file)}.woff2") format("woff2");
    font-style: map.get($f, style);
    font-weight: map.get($f, weight);
    font-display: swap;
  }
}

@function stack($family) {
  @if not map.has-key($font-stacks, $family) {
    @error "Unknown font stack '#{$family}'";
  }

  @return map.get($font-stacks, $family);
}

@mixin family($family) {
  font-family: stack($family);
}

@if $font-mode == "self-host" {
  $base: _with-slash($font-path);
  @each $f in $fonts {
    @include font-face($f, $base);
  }
}
